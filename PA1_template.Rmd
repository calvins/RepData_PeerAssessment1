---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
```{r setoptions,echo=FALSE}
library(knitr)
opts_chunk$set(fig.path = "figure/")
```

## Title

## Synopsis


## Data Processing
The dataset is a CSV file that is compressed to a zip file stored in the working directory.  It contains data submitted by an anonymous invidual recording the number of steps taken using an activity monitoring device like Fitbit.  We'll load the data with read.csv() and use unz() to access the zip file without uncompressing it.  To make grouping and summarizing easier, we'll configure dplyr.
```{r loadAndPreprocess, echo=TRUE, message=FALSE}
mydf <- read.csv(unz("activity.zip","activity.csv"),header=TRUE,sep=",")
library(dplyr)
activity <- tbl_df(mydf)
rm("mydf")
```

Explore the size of the activity data frame and the first few rows.
The dataset date range is October 2012 to November 2012, a total of 61 days.  Every 5 minutes, the number of steps were recorded and indexed using 5 minute intervals named 0 to 55, 100 to 155, 200 to 255, etc., and 2300 to 2355.  Essentially the hours are named using the 24-hour clock and each interval is a multiple of five from 5 to 55.  There are a total of 288 five minute intervals a day.
```{r exploreData, echo=TRUE}
dim(activity)
head(activity)
range(as.character(activity$date))
as.Date("2012-12-01")-as.Date("2012-10-01")
unique(activity$interval)
```

## What is mean total number of steps taken per day?
Ignore missing values and use dplyr group_by and summarize, to compute the total number of steps taken per day and save in new R object, totalStepsByDay. We'll make the variable names more descriptive and make a histogram of the total number of steps taken each day.  Finally, we calculate and report the mean and median of the total number of steps taken per day using the R function summary() and compare to the median() and mean() functions.
```{r totalStepsByDay, echo=TRUE}
totalStepsByDay <- summarize(group_by(activity, date), sum(steps,na.rm=TRUE))
names(totalStepsByDay) <-c("date","total")

options(digits=8)
summary(totalStepsByDay$total)
median(totalStepsByDay$total)
mean(totalStepsByDay$total)
```

```{r plot1, echo=TRUE}
hist(totalStepsByDay$total, col="aquamarine", main="Histogram - Total Steps per Day", breaks=5)
rug(totalStepsByDay$total)
```

## What is the average daily activity pattern?
Using dplyr summarize and group_by, we compute the means of steps for each 5-minute interval and ignore missing values.
We'll plot the mean steps taken by 5-minute interval across all days.
The R summary function tells us the maximum mean number of steps which we can plug in to the subset function and find the 5-minute interval with this value.
The interval 835 contains the maximum mean number of steps.
```{r meanStepsByInterval, echo=TRUE}
meansByInterval <- summarize(group_by(activity,interval),mean(steps,na.rm=TRUE))
names(meansByInterval) <-c("interval","means")

summary(meansByInterval$means)

subset(meansByInterval,means>206)
```

```{r plot2, echo=TRUE}
with(meansByInterval,plot(interval,means,type="l", main="Average number of steps taken"))
```

## Imputing missing values
Values are only missing in the steps variable and the logical vector, missingSteps helps identify the days when used with the unique() function.  The 8 days with missing values are 2012-10-01 2012-10-08 2012-11-01 2012-11-04 2012-11-09 2012-11-10 2012-11-14 2012-11-30.
The function nrow computes the total number of missing values in the dataset when we subset using the missingSteps logical vector.
Since we already have the means by interval for the entire dataset in the meansByInterval R object, my strategy to fill in the missing values is to set the missing value for each interval to the mean for each interval for each of the eight days.
First, create a new dataset called completeActivity by subsetting activity and selecting rows with dates not equal to 2012-10-01 2012-10-08 2012-11-01 2012-11-04 2012-11-09 2012-11-10 2012-11-14 2012-11-30.  This gives us the rows with values for steps.
Then we create temporary R objects for each day with missing values and set the missing values for each interval to the mean for each interval, thus applying our strategy.
We merge each day with imputed values into the new dataset completeActivity and check for missing values in the new dataset and find none.
We do some housekeeping by clearing the temporary R objects, add1 to add8.
To create out dataset for the plot, we use dplyr group_by and summarize to compute total number of steps taken per day using the completeActivity dataset that contains imputed missing values and save in new R object totalStepsByDayCompleteActivity.
We make the totalStepsByDayCompleteActivity variables more descriptive and make a histogram of the total number of steps taken each day.
We calculate and report the mean and median total number of steps taken per day and the histograms and summaries to the original dataset.
```{r imputeMissingValues, echo=TRUE}
sum(is.na(activity$date)) # 0 rows
sum(is.na(activity$interval)) # 0 rows
missingSteps <- is.na(activity$steps)
unique(activity[missingSteps,2]) 
nrow(activity[missingSteps,]) # 2,304 rows

completeActivity <- subset(activity,!(date %in% c("2012-10-01","2012-10-08","2012-11-01","2012-11-04","2012-11-09","2012-11-10","2012-11-14","2012-11-30")))

add1 <- data.frame(steps=meansByInterval$means,date="2012-10-01",interval=meansByInterval$interval)
add2 <- data.frame(steps=meansByInterval$means,date="2012-10-08",interval=meansByInterval$interval)
add3 <- data.frame(steps=meansByInterval$means,date="2012-11-01",interval=meansByInterval$interval)
add4 <- data.frame(steps=meansByInterval$means,date="2012-11-04",interval=meansByInterval$interval)
add5 <- data.frame(steps=meansByInterval$means,date="2012-11-09",interval=meansByInterval$interval)
add6 <- data.frame(steps=meansByInterval$means,date="2012-11-10",interval=meansByInterval$interval)
add7 <- data.frame(steps=meansByInterval$means,date="2012-11-14",interval=meansByInterval$interval)
add8 <- data.frame(steps=meansByInterval$means,date="2012-11-30",interval=meansByInterval$interval)

completeActivity <- rbind(completeActivity,add1)
completeActivity <- rbind(completeActivity,add2)
completeActivity <- rbind(completeActivity,add3)
completeActivity <- rbind(completeActivity,add4)
completeActivity <- rbind(completeActivity,add5)
completeActivity <- rbind(completeActivity,add6)
completeActivity <- rbind(completeActivity,add7)
completeActivity <- rbind(completeActivity,add8)

sum(is.na(completeActivity$steps)) # 0 rows

rm("add1");rm("add2");rm("add3");rm("add4");rm("add5");rm("add6");rm("add7");rm("add8");

totalStepsByDayCompleteActivity <- summarize(group_by(completeActivity, date), sum(steps,na.rm=TRUE))
names(totalStepsByDayCompleteActivity) <-c("date","totals")

options(digits=8)
summary(totalStepsByDayCompleteActivity$totals)
mean(totalStepsByDayCompleteActivity$totals) 
median(totalStepsByDayCompleteActivity$totals) 

options(digits=8)
summary(totalStepsByDay$total)
median(totalStepsByDay$total)
mean(totalStepsByDay$total)
```

```{r plot3, echo=TRUE, fig.height=8}
par(mfrow = c(2,1))
hist(totalStepsByDay$total, col="aquamarine", main="Histogram - Total Steps per Day", breaks=5)
rug(totalStepsByDay$total)
hist(totalStepsByDayCompleteActivity$totals, col="rosybrown", main="Histogram -Total Steps per Day using Imputed Missing Values", breaks=5)
rug(totalStepsByDayCompleteActivity$totals) # rug shows each data point in your data set
```

## Are there differences in activity patterns between weekdays and weekends?
We need a custom function makeDayTypeFactor that takes a vector of dates and returns a vector of factor variables with the levels weekday and weekend, using the weekdays() function.  This can be used to create a new dayType variable in the completeActivity dataset that has imputed missing values.
With the new factor variables, we use dplyr group_by and summarize to compute mean number of steps taken, by interval and day type and save in the new R object meansByIntervalByDayTypeCompleteActivity.
We make the variable names of meansByIntervalByDayTypeCompleteActivity more descriptive.
Finally, make a panel plot containing a time series plot of the 5-minute interval and the average number of steps taken, averaged across all weekday days or weekend days.
```{r patternsByDayType, echo=TRUE}
makeDayTypeFactor <- function(v) {
    results <- vector()
    for (s in v) {
        if (weekdays(strptime(s,"%Y-%m-%d")) %in% c("Monday","Tuesday","Wednesday","Thursday","Friday")) {
            results <- c(results,"weekday")
        } else {
            results <- c(results,"weekend")
        }        
    }
    as.factor(results)
}

completeActivity$dayType <- makeDayTypeFactor(completeActivity$date)

meansByIntervalByDayTypeCompleteActivity <- summarize(group_by(completeActivity, interval, dayType), mean(steps))

names(meansByIntervalByDayTypeCompleteActivity) <-c("interval","dayType", "means")
```

```{r plot4, echo=TRUE}
library(lattice)
xyplot(means ~ interval | dayType, type="l", data=meansByIntervalByDayTypeCompleteActivity, layout = c(1,2))
```

## Results
### What is mean total number of steps taken per day?
The mean total number of steps taken per day is 9,354 with a median of 10,395.  The 1st Quartile is 6,778, 3rd Quartile is 12,811, and a maximum of 21,194.  The histogram shows total steps concentrated in the range 10,000 to 15,000.  There are more data values in the range 0 to 10,000, than in the range 15,000 to 25,000.

### What is the average daily activity pattern?
The largest mean number of steps taken within a day's 5-minute interval is 206.17 in the 835 interval or at 8:35 am.  From intervals 0 to 500, the average number of steps is usually 0.  From time intervals 500 to about 900, the average number of steps increase from 0 to about 200.  There seems to be a pattern for the average number of steps for the intervals 1000 to 2000.  The average moves from around 50 to 100 and back to 50, during the ranges, 1000 to 1500, 1500 to 1750, and 1750 to 2000.  From intervals 2000 to 2355, the average moves gradually from 50 to 0.

### Do these values differ from the estimates from the first part of the assignment?
This table compares the summaries of the original dataset and the dataset with imputed missing values.
ORIGINAL
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
     0.0  6778.0 10395.0  9354.2 12811.0 21194.0
AFTER IMPUTING MISSING VALUES
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      41    9819   10766   10766   12811   21194

In the original dataset, the mean total number of steps taken per day is 9,354 with a median of 10,395.  The 1st Quartile is 6,778, 3rd Quartile is 12,811, and a maximum of 21,194.  The histogram shows total steps concentrated in the range 10,000 to 15,000.  There are more data values in the range 0 to 10,000, than in the range 15,000 to 25,000.

After imputing missing values, the mean total number of steps taken per day is 10,766 with a median of 10,766.  The 1st Quartile is 9,819, 3rd Quartile is 12,811, and a maximum of 21,194.  The histogram shows total steps concentrated in the range 7,500 to 15,000.  There are less data values in the ranges 0 to 5,000, and the range 20,000 to 25,000.

### What is the impact of imputing missing data on the estimates of the total daily number of steps?
After imputing missing values, and repeating the same analysis of the total number of steps per day, the new dataset distribution looks more Gaussian or normal.  When we compare the two histograms, the new plot contains more data about the mean.

### Are there differences in activity patterns between weekdays and weekends?
Yes, on weekends, the average steps taken per day goes to 50 later in the day than on the weekdays; about 750 compared to about 550.
Also, the pattern of the average in the intervals 1000 to 2000 is different on weekends.  The average moved to a high of about 150 on weekends, compared to 100 on weekdays.  There was also a couple of patterns visible during the weekends where the average moved from 50 to 100 and back to 50; the average also moved from 50 to 150 and back to 50.
During weekends and weekdays, the aveage steps moved from 50 to 0 in the intervals 2000 to 2300.
